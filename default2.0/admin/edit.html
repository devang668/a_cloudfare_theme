<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑文章 - CF-blog后台</title>
    <link rel="icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/gdtool/zhaopp/cfblog/favicon.ico" />
	<link rel="shortcut icon" type="image/x-icon"  href="https://cdn.jsdelivr.net/gh/gdtool/zhaopp/cfblog/favicon.ico"/>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <!--//<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/examples/css/style.css" />-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/css/editormd.css" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap-select/1.9.4/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    
    <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-zh_CN.min.js"></script>
	<style>
		/* 基础样式 */
		body {
			background-color: #f5f7fa;
			font-family: 'Microsoft YaHei', Arial, sans-serif;
		}
		
		/* 导航栏样式 */
		.navbar {
			background-color: #2c3e50;
			border: none;
			border-radius: 0;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			margin-bottom: 0;
		}
		
		.navbar-default .nav-tabs {
			border-bottom: none;
		}
		
		.navbar-default .nav-tabs > li > a {
			color: #ecf0f1;
			background-color: transparent;
			border: none;
			padding: 15px 20px;
			font-size: 16px;
			transition: all 0.3s ease;
		}
		
		.navbar-default .nav-tabs > li > a:hover {
			color: #3498db;
			background-color: rgba(255,255,255,0.05);
		}
		
		.navbar-default .nav-tabs > li.active > a,
		.navbar-default .nav-tabs > li.active > a:hover {
			color: #3498db;
			background-color: rgba(255,255,255,0.1);
			border-bottom: 3px solid #3498db;
		}
		
		/* 内容区域样式 */
		.tab-content {
			background-color: white;
			padding: 30px;
			margin: 20px auto;
			max-width: 1200px;
			border-radius: 4px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		
		/* 标题样式 */
		h3 {
			color: #2c3e50;
			margin-bottom: 30px;
			padding-bottom: 10px;
			border-bottom: 2px solid #ecf0f1;
		}
		
		/* 表单样式 */
		.form-group {
			margin-bottom: 20px;
		}
		
		.form-group label {
			color: #34495e;
			font-weight: 600;
			display: block;
			margin-bottom: 8px;
		}
		
		.form-control {
			border: 1px solid #ddd;
			border-radius: 4px;
			padding: 8px 12px;
			font-size: 14px;
			transition: border-color 0.3s ease;
		}
		
		.form-control:focus {
			border-color: #3498db;
			box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
		}
		
		/* 按钮样式 */
		.btn {
			padding: 8px 20px;
			border-radius: 4px;
			font-size: 14px;
			font-weight: 600;
			transition: all 0.3s ease;
			border: none;
			margin-right: 10px;
		}
		
		.btn-default {
			background-color: #3498db;
			color: white;
		}
		
		.btn-default:hover {
			background-color: #2980b9;
			color: white;
		}
		
		.btn-warning {
			background-color: #e74c3c;
			color: white;
		}
		
		.btn-warning:hover {
			background-color: #c0392b;
			color: white;
		}
		
		/* 编辑器样式 */
		#content {
			margin-top: 20px;
		}
		
		/* 下拉选择框样式 */
		.bootstrap-select > .dropdown-toggle {
			z-index: auto;
			border: 1px solid #ddd;
			border-radius: 4px;
		}
		
		/* 响应式设计 */
		@media (max-width: 768px) {
			.tab-content {
				padding: 15px;
				margin: 10px;
			}
			
			.form-group {
				width: 100% !important;
			}
			
			.form-control {
				width: 100% !important;
			}
			
			.navbar-default .nav-tabs > li > a {
				padding: 10px 15px;
				font-size: 14px;
			}
		}
	</style>
	
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
	<div class="container-fluid">
		<div class="navbar-header">
			<div class="navbar-brand" style="color: white; font-size: 20px; font-weight: bold; padding: 15px 20px;">
				CF-blog后台管理
			</div>
		</div>
	
	<div>
		<ul id="myTab" class="nav nav-tabs">
			<li class="active">
				<a href="/admin/" >返回文章</a>
			</li>
		</ul>
	</div>
	</div>
</nav>
<div id="myTabContent" class="tab-content">

		<div class="container-fluid">
			<h3>编辑文章</h3>   

			<form id="editForm" class="form-horizontal"  action="/" >

				<div class="form-group">
					<input type="hidden" class="form-control" name="id" id="id" readonly required="true">
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">标题</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="title" id="title" placeholder="请输入文章标题" required="true">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">特色图片</label>
					<div class="col-sm-10">
						<input type="url" class="form-control" name="img" id="img" placeholder="请输入图片URL">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">永久链接</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="link" id="link" placeholder="请输入永久链接" required="true">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">创建日期</label>
					<div class="col-sm-10">
						<input type="datetime-local" class="form-control" id="createDate" name="createDate" required="true">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">分类</label>
					<div class="col-sm-10">
						<select class="selectpicker form-control" multiple name="category[]" id="category">
						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">标签</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="tags" id="tags" placeholder="标签1,标签2">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">权重</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="priority" id="priority" value='0.5' placeholder="权重">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">更新频率</label>
					<div class="col-sm-10">
					    <select class="form-control" id="changefreq" name="changefreq">
						<option value="daily" >每日</option>
						<option value="hourly" >每小时</option>
						<option value="weekly" >每周</option>
						<option value="monthly" >每月</option>
						<option value="yearly" >每年</option>
						<option value="never" >从不</option>
						<option value="always" >总是</option>
					    </select>
					</div>
				</div>
				
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<a tabindex="0" role="button" type="submit" id="btn_saveEdit" class="btn btn-default" onclick="saveEdit()">保存</a>
						<a type="submit" role="button" id="btn_delete" class="btn btn-warning" onclick="deleteArticle()">删除</a>
					</div>
				</div>
				
				<div id="content"><textarea style="display:none;"></textarea></div>
			</form>
		</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/editormd.js"></script>   
<script type="text/javascript">
	$(function() {
		$('#myTab li:eq(0) a').tab('show');
		//获取文章
		var articleJson = <!--{articleJson}-->;
		//获取分类
		var categoryJson = <!--{categoryJson}-->;

		
		var mdEditor = editormd("content", {
				//width  : "90%",
				height : 640,
				path   : "https://cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/",
				appendMarkdown : articleJson.contentMD, //编辑器赋值
				saveHTMLToTextarea : true,
				mode : "markdown",
				tex  : true,
				tocm : true, 
				codeFold : true
			});
		//表单赋值
		$('#id').val(articleJson.id);
		$('#title').val(articleJson.title);
		$('#img').val(articleJson.img);
		$('#link').val(articleJson.link);
		$('#createDate').val(articleJson.createDate.replace(" ","T"));
		$('#tags').val(articleJson.tags);
		$('#priority').val( (articleJson.priority=== undefined ? "0.5":articleJson.priority) );
		$('#changefreq').selectpicker('val', (articleJson.changefreq === undefined ? "daily":articleJson.changefreq));
	
		$('#WidgetCategory').val(JSON.stringify(categoryJson));
		var category = $('#category');
		category.empty();
		for (var i = 0; i < categoryJson.length; i++) {
			category.append('<option id=' + categoryJson[i] + ' value=' + categoryJson[i] + '>' + categoryJson[i] + '</option>');
		}
		category.selectpicker('val',articleJson.category);
	});
    //保存按钮(编辑)
    function saveEdit(){
        $.ajax({
            type: "POST",
            dataType: "json",
			contentType: "application/json; charset=utf-8",
            url: "/admin/saveEdit/" ,//url
            data: JSON.stringify($("#editForm").serializeArray()), 
            success: function (result) {
                alert(result.msg);
            }
        });
    }
    //删除
    function deleteArticle(){
        if (confirm("确定删除吗?删除后重新发布才能生效")==false){ 
            return false; 
          }
        $.ajax({
            type: "POST",
            dataType: "json",
			contentType: "application/json; charset=utf-8",
            url: "/admin/delete/"+$('#id').val() ,//url
            data: [{"id":$('#id').val()}],
            success: function (result) {
                alert(result.msg);
            }
        });
    }
</script>
  
</body>

</html>
